---
layout: single
title: "[운영체제] 프로세스 관리"
categories: OS
---

# :fire: 프로세스란?

디스크에 실행파일 형태로 존재하던 프로그램이 메모리에 올라가서 실행되기 시작

# :fire: 프로세스의 상태

- 실행 : 프로세스가 CPU를 보유하고 기계어 명렁을 실행하고 있는 상태
- 준비 : CPU를 보유하면 당장 명령을 실행할 수 있지만 CPU를 할당받지 못한 상태
- 봉쇄 : CPU를 할당받아도 당장 명령을 실행할 수 없는 상태  
  ex) 프로세스가 요청한 입출력 작업이 진행 중인 경우

<b>프로세스가 생성/종료 중인 일시적 상태</b>

- 시작 : 프로세스가 시작되어 자료구조는 생성되었지만 메모리를 획득하지 못한 상태
- 종료 : 프로세스가 종료되었으나 운영체제가 관련 자료구조를 완전히 정리하지 못한 상태

<img src="/assets/OS/프로세스 상태.jpg"/>

### 입출력을 요청한 프로세스의 상태 변화

1. 프로세스가 CPU를 할당 받아 명령 수행
2. 입출력 요청

- 입출력이 진행되는 동안 프로세스가 CPU를 점유하고 있어도 후속 명령을 처리할 수 없음 -> CPU 낭비

3. 입출력 완료를 기다리며 봉쇄 상태로 전환

- 준비 상태에 있는 프로세스 중 하나에게 CPU를 할당 -> 이 프로세스는 준비 상태에서 실행 상태로 전환

4. 입출력이 완료된 프로세스의 상태를 준비 상태로 전환

# :fire: 프로세스 제어블록

프로세스 제어블록(Process Control Block)이란 운영체제가 시스템 내의 프로세스들을 관리하기 위해 프로세스마다 유지하는 정보들을 담는 커널 내의 자료구조

<b>프로세스 제어블록 구성</b>

- 프로세스의 상태 : CPU를 할당해도 되는지 결정
- 프로그램 카운터의 값 : 다음에 수행할 명령의 위치
- CPU 레지스터 값 : CPU 연산을 위해 현재 레지스터에 어떤 값을 저장하고 있는지 나타냄
- CPU 스케줄링 정보 : CPU스케줄링을 위해 필요한 정보
- 메모리 관리 정보 : 메모리 할당을 위해 필요한 정보
- 자원 사용 정보
- 입출력 상태 정보

# :fire: 문맥 교환

문맥교환이란 프로세스가 다른 프로세스로 CPU의 제어권이 넘어가는 과정을 뜻한다

<img src="/assets/OS/문맥교환.jpg"/>

- 프로세스가 CPU를 할당받고 실행되던 중 타이머 인터럽트가 발생하면 CPU의 제어권이 운영체제로 넘어간다
- 운영체제는 타이머 인터럽트 처리루틴으로 가서 직전까지 수행 중이던 프로세스의 문맥을 저장한다
- 새롭게 실행시킬 프로세스에게 CPU 이양
- 원래 수행 중이던 프로세스는 실행 상태->준비 상태 / 새롭게 할당받은 프로세스는 준비 상태->실행 상태

<b>문맥교환이 발생하는 경우</b>

- 타이머 인터럽트가 발생한 경우
- 실행 중인 프로세스가 입출력 요청 등 봉쇄 상태가 되는 경우

:heavy_check_mark: 프로세스가 실행 상태일 때 시스템 콜이나 인터럽트가 발생하면 CPU제어권이 운영체제로 넘어와 커널의 코드가 실행된다. 이 경우에도 CPU 실행위치, 프로세스 문맥 등을 PCB에 저장하지만 문맥교환이라고 하지 않는다.

# :fire: 프로세스를 스케줄링하기 위한 큐

### 준비 큐(ready queue)

운영체제는 준비 상태에 있는 프로세스들을 줄 세우기 위해 준비 큐를 두고 제일 앞에 있는 프로세스에 가장 먼저 CPU를 할당한다.

### 장치 큐(device queue)

특정 자원을 기다리는 프로세스들을 줄 세우기 위한 자원별 큐  
ex) 디스크 입출력을 요청한 프로세스들은 디스크 입출력 큐에 줄 선다

1. 디스크 컨트롤러는 디스크 입출력 큐에 있는 순서대로 입출력 작업 수행
2. 작업이 완료되면 디스크 컨트롤러가 CPU에 인터럽트 발생시킴
3. 인터럽트 처리루틴에 의해 완료된 프로세스는 장치 큐에서 빠져나와 CPU를 기다리는 준비 큐로 이동

:heavy_check_mark: 위와 같은 하드웨어 자원을 기다리기 위해 필요한 큐 외에 소프트웨어 자원을 기다리는 경우에도 큐가 필요

### 작업 큐(job queue)

시스템 내의 모든 프로세스르 관리하기 위한 큐  
프로세스의 상태와 무관하게 모든 프로세스가 작업 큐에 속한다

:maple_leaf: 따라서 작업 큐에 있다고 반드시 메모리를 가지고 있지는 않음

큐는 각 프로세스의 PCB를 연결 리스트 형태로 관리하고 포인터를 사용해 순서를 정한다

# :fire: 스케줄러

스케줄러란 어떤 프로세스에게 자원을 할당할지 결정하는 운영체제 커널의 코드

단기 스케줄러 == CPU 스케줄러 : 준비 상태의 프로세스 중 어떤 프로세스를 다음에 실행 상태로 만들 것인지 결정하는 역할

- 빈번하게 호출되기 때문에 수행 속도가 빨라야 한다

장기 스케줄러 == 작업 스케줄러 : 어떤 프로세스를 준비 큐에 진입시킬지 결정하는 역할

- 호출이 빈번하지 않기 때문에 상대적으로 속도가 느린 것이 허용
- 메모리에 동시에 올라가 있는 프로세스의 수를 조절
- 시작 상태의 프로세스에게 메모리를 할당할 것인지 승인 여부
- 과거에 자원이 빈약하던 시절에 주로 사용 : 적은 양의 메모리를 효율적으로 할당하기 위해 조절 역할 담당

:heavy_check_mark: 현대의 시분할 시스템용 운영체제에서는 시작 상태가 되면 장기 스케줄러 없이 바로 메모리를 할당 - 중기 스케줄러를 두는 경우가 많음  
중기 스케줄러는 프로세스당 보유 메모리가 지나치게 적어진 경우 일부 프로세스를 메모리에서 빼앗아 그 내용을 디스크의 스왑 영역에 저장한다 :point_right: <b>스왑 아웃(swap out)

<img src="/assets/OS/프로세스 상태2.jpg"/>
[중지 상태를 포함한 프로세스의 상태 변화]

중지(suspended) 상태 : 외부적인 이유로 프로세스의 수행이 정지된 상태  
중지 상태에 있는 프로세스는 메모리 자원이 당장 필요하지 않으므로 메모리를 빼앗기고 디스크로 스왑 아웃된다  
중기 스케줄러에 의해 디스크로 스왑 아웃된 프로세스의 상태가 대표적인 중지 상태의 예

- 준비상태에 있떤 프로세스가 디스크로 스왑 아웃되면 보류준비 상태가 된다
- 대기상태에 있던 프로세스가 스왑 아웃되면 보류대기 상태가 된다

# :fire: 프로세스의 생성
